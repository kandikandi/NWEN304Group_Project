<!DOCTYPE html>
<html lang="en">
<head>
	<!-- load up the scripts, links, etc. -->
    <% include ../partials/head %>
</head>

<body>
	<% include ../partials/header %>  

	<div class="jumbotron">
    	<h2>This is the login page</h2>
    	<form class="form-login">
        	<h2>Please log in</h2>
        	<label for="inputUsername" class="sr-only">Username</label>
        	<input type="username" id="inputUsername" class="form-control" placeholder="Username" required autofocus>
        	<label for="inputPassword" class="sr-only">Password</label>
        	<input type="password" id="inputPassword" class="form-control" placeholder="Password" required>
        	<button id="login_button" class="btn btn-lg btn-primary btn-block" type="submit">Log in</button>
      	</form>
        <a href = "/auth/facebook"><button class="btn btn-default">Log in with Facebook</button></a>
    </div>
</body>

<script>

var ERROR_LOG = console.error.bind(console);
var ip = 'https://evening-cove-32171.herokuapp.com'; // app address

//GET recieves the information from the items table in database, no changes are made
$.ajax({
    url: ip+'/login',
    type: "GET",
    }).then(redraw, ERROR_LOG);

function redraw(data){
    console.log('redrawing', data);
    }; 

$('#login_button').on('click', function(){

    var username = $('#inputUsername').val();
    var password = $('#inputPassword').val();

    var userdetail = {username, password};
    check_user(userdetail);
});

function check_user(user){
    console.log("calling post");
    $.ajax({
        method: 'POST',
        url: ip+'/login/auth',
        data: JSON.stringify({
            userdetails: user
        }),
        contentType: "application/json",
        dataType: "json",
        }).then(function success_login(data){
             console.log("USER LOGGED IN");      
        }, console.error.bind(console));
}

</script>

</html>
